<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>maven实践 </title>
    <meta name="author" content="hongbing" />
    <meta name="renderer" content="webkit">
    <meta name="description" content="hongbing的部落格" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <link rel="stylesheet" href="/css/default.css" type="text/css" />
    <link rel="stylesheet" href="/css/syntax.css" type="text/css" />
    <link rel="shortcut icon" href="/jinchuan.png" type="image/x-icon" />
    <link rel="alternate" type="application/atom+xml" title="Recent Entries" href="" />
    <script src="/js/jquery-1.7.1.min.js" type="text/javascript"></script>
</head>
<body>
      <div id="header_wrap" class="outer">
        <header class="inner">
                <div id="project_title" align="center"><a href="/">hongbingの部落格</a></div>
                <div id="project_tagline" align="center">ONCE A GEEK, FOREVER A GEEK</div>
    <!--    
	        <div id="nav" class="navbar">
                         <div id="home" class="navbar"><a href="/">Home</a></div>
                         <div id="archive" class="navbar"><a href="/archive">Archive</a></div>
                         <div id="about" class="navbar"><a href="/about">About</a></div>
                </div>
-->	</header>
</div>
 
         <link rel="stylesheet" href="/js/prettify/prettify.css" />
<style type="text/css">
    body { background:#e8e8e8; }
    @media screen and (max-width: 750px){
        body { background:#fff; }
    }
    @media screen and (max-width: 1020px){
        body { background:#fff; }
    }
</style>

<div id="content">
    <div class="entry">
        <h1 class="entry-title"><a href="/posts/blog/:short_year/:month/:day/maven.html" title="maven实践">maven实践</a></h1>
        <p class="entry-date"></p>
<!--
	
-->
	<h2 id="section">1 相关概念</h2>

<h3 id="section-1">1.1 版本号</h3>

<p>版本号记录一个项目在某个阶段的某些功能的实现，实现项目中不同功能的隔离与区分。<br />
版本号格式一般分为：</p>

<p><code>主版本号.分支版本号.小版本号-里程碑版本号</code></p>

<p><strong>主版本号</strong>：一般指框架具有重大变化的版本号，比如struts1，struts2框架的变化</p>

<p><strong>分支版本号</strong>： 一般指功能的变化<br />
<!-- more --></p>

<p><strong>小版本号</strong>：bug的修复</p>

<p><strong>里程碑版本号</strong>：<code>SNAPSHOT</code>–&gt;<code>RELEASAE</code>–&gt;<code>FINAL</code></p>

<h3 id="section-2">1.2 仓库分类</h3>

<p>狭义上讲，仓库分为两种，一种是本地仓库，一种是远程仓库。</p>

<p>广义上讲，远程仓库也可分为私有仓库和中心仓库，也即是分为三种：本地仓库，私有仓库和中心仓库</p>

<h4 id="section-3">1.2.1 本地仓库</h4>

<p>即为本地的./.m2/repository文件夹，项目中需要的jar包都会被保存在本地仓库中，项目的更新操作（commit操作）都会首先同步到本地仓库中。</p>

<h4 id="section-4">1.2.2 私有仓库</h4>

<p>局域网内部的仓库，当本地仓库没有项目中所需要的jar包时，从私有仓库中找，如果存在，就将其下载到本地仓库中。同时，针对多人协作开发，可以将不同的开发版本deploy到私有仓库中。<br />
私有仓库的作用为：提升查找jar包的速度，进行项目版本管理。</p>

<p>（注：使用commit and push命令只会将本地的代码提交到仓库中，使用deploy才会在仓库中为此项目打一个jar或者war包。）</p>

<p>私有仓库中的仓库类型也分为几类：</p>

<blockquote>
  <p><strong>RELEASE</strong>：项目发布版本的存放地</p>
</blockquote>

<blockquote>
  <p><strong>SNAPSHOT</strong>：项目开发版本的存放地</p>
</blockquote>

<blockquote>
  <p><strong>3rd party</strong>：第三方项目，后者是第三方jar包的存放地，这个里面的内容一般由内部人员添加.</p>
</blockquote>

<blockquote>
  <p><strong>group</strong>：将仓库中的多个内容添加到一起组成一个group，这样在项目的pom.xml文件中指定所需要的jar包时就可以通过group的方式，而不必每一个jar包都下一个dependency。</p>
</blockquote>

<p><img src="/images/maven/repository.png" alt="私有仓库示例" /></p>

<h4 id="section-5">1.2.3 中心仓库</h4>
<p>maven远程服务器管理的仓库，地址是<a href="http://repo1.maven.org.maven2">maven中心仓库</a></p>

<h3 id="section-6">1.3 项目的发布</h3>

<p>在项目中添加</p>

<div class="highlight"><pre><code class="language-maven" data-lang="maven">&lt;distributeManagement&gt;
    &lt;snapshotRepository&gt;
    &lt;id&gt;firehose.0.0.1-snapshot&lt;/id&gt;
    &lt;name&gt;firehose-SNAPSHOT&lt;/name&gt;
    &lt;url&gt;10.30.XXX.XXX/nexus/content/Repositories/snapshots/&lt;/url&gt;
    &lt;/snapshotRepository&gt;
&lt;/distributeManagement&gt;</code></pre></div>

<p>使用<code>mvn deploy</code>命令即可将项目发布到私有仓库中，也即是上面的url中</p>

<h3 id="maven">1.4 maven的生命周期</h3>

<p>maven的3种独立的生命周期</p>

<ul>
  <li><strong>clean</strong></li>
</ul>

<p>pre-clean 准备清理工作</p>

<p>clean 清理</p>

<p>post-clean 清理后需要做的工作</p>

<ul>
  <li><strong>compile</strong></li>
</ul>

<p>validate</p>

<p>generate-sources</p>

<p>process-sources</p>

<p>generate-resources</p>

<p>process-resources     复制并处理资源文件，至目标目录，准备打包。</p>

<p>compile     编译项目的源代码。</p>

<p>process-classes</p>

<p>generate-test-sources</p>

<p>process-test-sources</p>

<p>generate-test-resources</p>

<p>process-test-resources     复制并处理资源文件，至目标测试目录。</p>

<p>test-compile     编译测试源代码。</p>

<p>process-test-classes</p>

<p>test     使用合适的单元测试框架运行测试。这些测试代码不会被打包或部署。</p>

<p>prepare-package</p>

<p>package     接受编译好的代码，打包成可发布的格式，如 JAR 。</p>

<p>pre-integration-test</p>

<p>integration-test</p>

<p>post-integration-test</p>

<p>verify</p>

<p>install     将包安装至本地仓库，以让其它项目依赖。</p>

<p>deploy     将最终的包复制到远程的仓库，以让其它开发人员与项目共享。</p>

<ul>
  <li><strong>site</strong></li>
</ul>

<p>pre-site     执行一些需要在生成站点文档之前完成的工作</p>

<p>site    生成项目的站点文档</p>

<p>post-site     执行一些需要在生成站点文档之后完成的工作，并且为部署做准备</p>

<p>site-deploy     将生成的站点文档部署到特定的服务器上</p>

<p><strong>clean</strong>、<strong>compile</strong>和<strong>site</strong>这三个生命周期是不相关的。执行每一个生命周期，其前面的所有阶段都会被执行。生命周期中的每一个操作都是以插件机制完成的。</p>

<h2 id="maven-1">2 maven实践</h2>

<h3 id="jar">2.1 手动添加jar包到仓库</h3>

<p><strong>本地仓库</strong></p>

<div class="highlight"><pre><code class="language-maven" data-lang="maven">mvn install:install-file -DgroupId=jar的groupId
-DartifactId=jar的artifactId -Dversion=jar的version
 -Dfile=jar包的路径 -Dpackaging=jar</code></pre></div>

<p>一个命令将二进制，源码和javadoc都上传到本地仓库：</p>

<div class="highlight"><pre><code class="language-maven" data-lang="maven">mvn install:install-file  -DgroupId=jar的groupId
-DartifactId=jar的artifactId -Dversion=jar的version
-Dfile=二进制jar包的路径  -Dsources=sources jar包的路径
-Djavadoc=javadoc jar包的路径</code></pre></div>

<p><strong>远程仓库</strong></p>

<div class="highlight"><pre><code class="language-maven" data-lang="maven">mvn deploy:deploy-file  -DgroupId=jar的groupId
-DartifactId=jar的artifactId -Dversion=jar的version
-Dfile=二进制jar包的路径  -Dsources=sources jar包的路径
-Djavadoc=javadoc jar包的路径</code></pre></div>

<p><em>注：在上述命令后都可以指定上传的仓库地址，在命令后面添加<code>-url=file://path/to/repository</code>，如果没有指定则会依据maven的setting.xml中的配置</em></p>

<p>添加到maven库中后，使用该jar包时需要修改maven工程的pom.xml文件，将添加的jar包加入到pom.xml文件中即可使用。</p>

<h3 id="mavenweb-app">2.2 maven创建web-app</h3>
<p>使用maven创建web-app，需要自行建文件夹src/main/java包。</p>

<p>支持web-app发布到tomcat的插件：cargo</p>

<p>支持web-app发布到jetty的插件：jetty-maven-plugin</p>

<h3 id="maven-2">2.3 maven查找包依赖</h3>

<ul>
  <li>使用maven project report插件来显示所有的项目依赖关系</li>
</ul>

<p>在项目pom.xml的<project></project>里添加 maven插件maven-project-info-reports-plugin：</p>

<div class="highlight"><pre><code class="language-maven" data-lang="maven">&lt;reporting&gt;
  &lt;plugins&gt;
   &lt;plugin&gt;
    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
    &lt;artifactId&gt;
     maven-project-info-reports-plugin
    &lt;/artifactId&gt;
     &lt;version&gt;2.4&lt;/version&gt;
   &lt;/plugin&gt;
 &lt;/plugins&gt;
 &lt;/reporting&gt;</code></pre></div>

<p>使用这个插件，然后执行命令：</p>

<p><code>mvn  project-info-reports:dependencies</code></p>

<p>就可以在target/site/dependencies.html里查看依赖报表，通过这个报表就能够找到冲突的版本，然后再使用exclusions来排除相关的包。</p>

<div class="highlight"><pre><code class="language-maven" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;com.x.y&lt;/groupId&gt;
    &lt;artifactId&gt;xyz&lt;/artifactId&gt;
    &lt;version&gt;1.1.1&lt;/version&gt;
    &lt;exclusions&gt;
            &lt;exclusion&gt;
                    &lt;groupId&gt;com.u.v&lt;/groupId&gt;
                    &lt;artifactId&gt;uvw&lt;/artifactId&gt;
                    &lt;version&gt;0.9.1&lt;/version&gt;
            &lt;/exclusion&gt;
    &lt;/exclusions&gt;
&lt;/dependency&gt;</code></pre></div>

<p>另外使用命令</p>

<p><code>mvn dependency:analyze</code></p>

<p>可以分析出显示声明但没有依赖的包，可以将其去除。</p>

<ul>
  <li>使用脚本显示循环依赖包</li>
</ul>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">#!/bin/bash
</span>
<span class="c">### find cycle in maven depnedency tree
</span>

<span class="k">if</span> <span class="o">[</span> <span class="nv">$# </span>-gt 0 <span class="o">]</span>;<span class="k">then
    </span><span class="nv">sourcepath</span><span class="o">=</span><span class="nv">$1</span>
<span class="k">else
    </span><span class="nv">sourcepath</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>
<span class="k">fi
if</span> <span class="o">[</span> ! -f <span class="s2">"</span><span class="nv">$sourcepath</span><span class="s2">/pom.xml"</span> <span class="o">]</span>; <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$sourcepath</span><span class="s2"> is not a vaild maven project!"</span>
    <span class="nb">echo</span> <span class="s1">'Usage : ./findcycle [path]'</span>
    <span class="nb">exit </span>1;
<span class="k">fi
</span><span class="nv">mvn</span><span class="o">=</span><span class="sb">`</span>which mvn<span class="sb">`</span>
<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$mvn</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">""</span> <span class="o">]</span>;<span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"counld not found mvn in PATH,exit!"</span>
    <span class="nb">exit </span>1;
<span class="k">fi

</span><span class="nb">cd</span> <span class="nv">$sourcepath</span>
<span class="nb">echo</span> <span class="s2">"scan cycle dependency in </span><span class="nv">$sourcepath</span><span class="s2"> ..."</span>
mvn dependency:tree -Dverbose | awk -F<span class="s1">'- '</span> <span class="s1">'{if(index($2,"maven-dependency-plugin")&gt;0){indent=0;}else{indent=length($1);}stack[indent]=$2;if(index($0,"for cycle")&gt;0){print "****found cycle****";for(i=0;i&lt;=indent;i++){if(stack[i]!=null){print "-&gt;"stack[i]}}}}'</span>
<span class="nb">echo</span> <span class="s2">"scan finished!"</span></code></pre></div>

<p>使用上面的脚本（将其放置于工程目录下，或者指定工程路径）检测是否存在循环依赖，如果存在，会输出循环依赖的链。（此脚本取自于@秦迪 <a href="http://blog.2baxb.me">Axb的自我修养</a>）</p>

<p>附 <a href="/script/findCycle.sh">findClycle.sh</a></p>

<p><img src="/images/maven/jewel.jpg" alt="jewel" /></p>

	<ul class="pager">
            

            
	</ul>
	<div id="disqus_thread"></div>
<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */
    /*
    var disqus_config = function () {
        this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() {  // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        
        s.src = '//hongbing.disqus.com/embed.js';
        
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

    </div>

    <div class="sidenav">
	<iframe width="100%" height="85" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=85&fansRow=2&ptype=1&speed=0&skin=1&isTitle=0&noborder=0&isWeibo=0&isFans=0&uid=2702608131&verifier=f3af5509&dpc=1"></iframe>
    </div>

    <div class="sidenav">
        <h2>Blog</h2>
        <ul class="artical-list">
        
            <li><a href="/posts/blog/2016/06/15/nginx-lua.html">openresty memcached实践</a></li>
        
            <li><a href="/posts/blog/2016/05/21/linux-common-command.html">工作中常用的linux命令</a></li>
        
            <li><a href="/posts/blog/2016/05/19/hardware-interrupt-balance.html">硬件中断均衡</a></li>
        
            <li><a href="/posts/blog/2016/04/17/a-oom-problem.html">一次oom的排查过程</a></li>
        
            <li><a href="/posts/blog/2015/11/14/monitor-principle.html">监控模式</a></li>
        
            <li><a href="/posts/blog/2015/11/14/jetty-deadlock.html">jetty6 deadlock</a></li>
        
            <li><a href="/posts/blog/2015/08/21/linux-of-blockdump.html">linux系统之block_dump</a></li>
        
            <li><a href="/posts/blog/2015/08/20/linux-of-pdflush.html">linux系统之pdflush</a></li>
        
            <li><a href="/posts/blog/2015/08/11/UnknowHostException.html">UnknowHostException</a></li>
        
            <li><a href="/posts/blog/2015/08/02/haproxy-install.html">haproxy部署</a></li>
        
            <li><a href="/posts/blog/2015/07/25/maven-introduce.html">maven实践</a></li>
        
            <li><a href="/posts/blog/2015/06/21/etcd-vs-consul.html">ETCD vs. Consul</a></li>
        
            <li><a href="/posts/blog/2015/06/21/distributed-id-generator.html">分布式ID生成器</a></li>
        
            <li><a href="/posts/blog/2015/06/17/what-is-good-code.html">什么样的代码才是好的代码</a></li>
        
            <li><a href="/posts/blog/2015/06/17/raft-introduce.html">Raft</a></li>
        
        </ul>
<!--
        <h2>Opinion</h2>
        <ul class="artical-list">
        
        </ul>

        <h2>Project</h2>
        <ul class="artical-list">
        
        </ul>-->
     </div>
</div>
<script src="/js/jquery-1.7.1.min.js"" type="text/javascript"></script>
<script src="/js/post.js" type="text/javascript"></script>

      

</body>
</html>
